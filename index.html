<!DOCTYPE html>
<html>

<head>
    <title>ChatBot</title>
    <link rel="stylesheet" href="chatbot.css">
</head>

<body>
    
    <div class="js-container"></div>

    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>

    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>


    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script type="text/babel">
        function ChatInput({ chatMessages, setChatMessages }) {

            const [inputText, setInputText] = React.useState('');



            function saveInputText(event) {
                setInputText(event.target.value);
            }

            function sendMessage() {

                const newChatMessages = [
                    ...chatMessages,                     //copying chatmessages (arr[0]) to setChatmessage
                    {
                        message: inputText,                 //add new chat message at the end
                        sender: 'user',
                        id: crypto.randomUUID()
                    }

                ]
                setChatMessages(newChatMessages);


                const response = Chatbot.getResponse(inputText);
                setChatMessages([
                    ...newChatMessages,                     //copying chatmessages (arr[0]) to setChatmessage
                    {
                        message: response,                 //add new chat message at the end
                        sender: 'robot',
                        id: crypto.randomUUID()
                    }

                ]);

                setInputText('');
            }



            return (
                <div className="chat-input-container">
                    <input
                        placeholder="Send a message to ChatBot"
                        size="30"
                        onChange={saveInputText}
                        value={inputText}
                        className="chat-input"
                    />
                    <button
                        onClick={sendMessage}
                        
                        className="send-button"
                        >Send</button>
                </div>
            );
        }

        function ChatMessage({ message, sender }) {
            /*const message = props.message;
            const sender = props.sender;
            const{message,sender} = props;

            if(sender === 'robot'){
                return(
                   <div>
                        <img src="robot.png" width="50" />
                        {message}
                    </div> 
                )
            }*/

            return (
                <div className={sender==='user'? 'chat-message-user': 'chat-message-robot'}>
                    {sender === 'robot' && (
                        <img src="robot.png" className="chat-message-profile" />)}
                    <div className="chat-message-text">
                        {message}
                    </div>
                    {sender === 'user' &&
                        (<img src="user.png" className="chat-message-profile"/>)}
                </div>
            )
        }

        function ChatMessages({ chatMessages }) {
            const chatMessagesRef =  React.useRef(null);
            React.useEffect(()=>{
                const containerElem = chatMessagesRef.current;
                if(containerElem){
                    containerElem.scrollTop = containerElem.scrollHeight;
                }
            },[chatMessages]);
            return (
                <div 
                className="chat-messages-container"
                ref={chatMessagesRef}
                >
                    {
                        chatMessages.map((chatMessage) => {
                            return (
                                <ChatMessage
                                    message={chatMessage.message}
                                    sender={chatMessage.sender}
                                    key={chatMessage.id}
                                />
                            );
                        })
                    }
                </div>
            )
        }

        function App() {
            const [chatMessages, setChatMessages] = React.useState([])
            // const chatMessages = array[0]; // gives the current data
            // const setChatMessages = array[1]; //second value is the function that updates the data

            //const [chatMessages, setChatMessages] =array;

            return (
                <div className="app-container">
                    <ChatMessages
                    chatMessages={chatMessages}
                    />
                    <ChatInput
                        chatMessages={chatMessages}
                        setChatMessages={setChatMessages}
                    />
                </div>
            );
        }


        const container = document.querySelector('.js-container');
        ReactDOM.createRoot(container).render(<App />);

    </script>
</body>
 
</html>